{% extends 'AdminBundle::base.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('assets/node_modules/jsoneditor/dist/jsoneditor.min.css') }}">
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('assets/node_modules/jsoneditor/dist/jsoneditor.min.js') }}"></script>
  <script>
	 var schema = {{ include_file(kernelRootDir ~ '/../web/assets/schema/feed.schema.json') }},
	 el = document.getElementById('{{ form.configuration.vars.id }}');
     el.type = 'hidden';

   var container = document.createElement('div');
   el.parentNode.insertBefore(container, el);

   var json = {
     "url": "",
     "type": "",
     "root": "",
     "baseUrl": "",
     "mapping": {
       "id": "",
       "name": "",
       "occurrences": {
         "path": "",
         "mapping": {
           "startDate": "",
           "endDate": "",
           "venue": ""
         }
       }
     },
     "defaults": {}
   };

   var options = {
     schema: schema,
     modes: [ 'tree', 'view', 'form', 'code', 'text' ],
     onChange: function() {
       try {
         el.value = JSON.stringify(editor.get());
       } catch (ex) {}
     }
   };

   // create the editor
   var editor = new JSONEditor(container, options, json);
   editor.expandAll();
  </script>
{% endblock %}

{% block body -%}
  <h1>Feed creation</h1>

  {{ form(form) }}

  <div id="jsoneditor"></div>

  <ul class="record_actions">
    <li>
      <a href="{{ path('admin_feed') }}">
        Back to the list
      </a>
    </li>
  </ul>
{% endblock %}
