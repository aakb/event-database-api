{% extends 'AdminBundle::base.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('assets/node_modules/jsoneditor/dist/jsoneditor.min.css') }}">
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('assets/node_modules/jsoneditor/dist/jsoneditor.min.js') }}"></script>
  <script>
		var schema = {{ include_file(kernelRootDir ~ '/../web/assets/schema/feed.schema.json') }},
		el = document.getElementById('{{ edit_form.configuration.vars.id }}');
		el.type = 'hidden';

   var container = document.createElement('div');
   el.parentNode.insertBefore(container, el);

   var json = JSON.parse(el.value);

   var options = {
     schema: schema,
     modes: [ 'tree', 'view', 'form', 'code', 'text' ],
     onChange: function() {
       try {
         el.value = JSON.stringify(editor.get());
       } catch (ex) {}
     }
   };

   // create the editor
   var editor = new JSONEditor(container, options, json);
   editor.expandAll();
  </script>
{% endblock %}

{% block body -%}
  <h1>{{ 'Edit feed' | trans }}</h1>

  {{ form_start(edit_form) }}
  {{ form_rest(edit_form) }}
	<div class="actions">
		<a class="btn btn-default" href="{{ path('admin_feed') }}">{{ 'Cancel' | trans  }}</a>
		<button class="btn btn-primary" type="submit">{{ 'Save' | trans }}</button>
	</div>
  {{ form_end(edit_form) }}

  <div id="jsoneditor"></div>


  <div class="actions">
		{{ form_start(delete_form) }}
		{{ form_rest(delete_form) }}
		<div class="actions">
			<button class="btn btn-danger" type="submit">{{ 'Delete' | trans }}</button>
		</div>
		{{ form_end(delete_form) }}
	</div>
{% endblock %}
